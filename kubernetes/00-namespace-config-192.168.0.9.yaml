# Kubernetes Configuration for CRM Solution
# Deployment Target: 192.168.0.9
# Configuration: Frontend/API on Kubernetes, Databases on Docker
#
# This configuration connects to databases running in Docker containers
# on the same host (192.168.0.9)
#
# Usage:
#   kubectl apply -f 00-namespace-config-192.168.0.9.yaml

---
apiVersion: v1
kind: Namespace
metadata:
  name: crm-app
  labels:
    environment: production
    deployment: "192.168.0.9"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: crm-config
  namespace: crm-app
data:
  # Application Environment
  ASPNETCORE_ENVIRONMENT: "Production"
  NODE_ENV: "production"
  
  # Database Configuration - SQL Server (Docker container on 192.168.0.9)
  DatabaseProvider: "sqlserver"
  DB_HOST: "192.168.0.9"
  DB_PORT: "1433"
  DB_NAME: "crm_db"
  
  # API Configuration
  API_INTERNAL_PORT: "5000"
  API_EXTERNAL_PORT: "5000"
  
  # Frontend Configuration
  REACT_APP_API_URL: "http://192.168.0.9:5000/api"
  FRONTEND_EXTERNAL_PORT: "80"
  Frontend__Url: "http://192.168.0.9"
  
  # Demo Database (auto-seeded)
  DemoDatabase__AutoSeed: "true"
  DemoDatabase__DatabaseName: "crm_demodb"
  
  # Contract Storage
  CONTRACT_STORAGE_PATH: "/app/data/contracts"
  MAX_CONTRACT_FILE_SIZE_BYTES: "10485760"
  ALLOWED_CONTRACT_MIME_TYPES: "application/pdf,image/png,image/jpeg,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
  
  # Monitoring Configuration
  Monitoring__DeploymentType: "kubernetes"
  Monitoring__BuildServer: "192.168.0.9"
  Monitoring__BuildServerFQDN: "crm.local"
  Monitoring__EnableDockerMonitoring: "true"
  Monitoring__EnableK8sMonitoring: "true"
  Monitoring__KubernetesNamespace: "crm-app"
  Monitoring__DatabaseProvider: "sqlserver"
  
  # Redis Configuration
  Redis__ConnectionString: "192.168.0.9:6379"
  Redis__InstanceName: "crm_"
  Redis__Enabled: "true"
  
  # CORS Configuration
  AllowedOrigins: "http://192.168.0.9,http://192.168.0.9:80,http://192.168.0.9:3000"

---
apiVersion: v1
kind: Secret
metadata:
  name: crm-secrets
  namespace: crm-app
type: Opaque
stringData:
  # JWT Configuration
  JWT_SECRET: "CrmJwtSecretKey2024!@#$%^&*()ForSecureAuthentication"
  JWT_ISSUER: "CRMApp"
  JWT_AUDIENCE: "CRMUsers"
  JWT_EXPIRATION_MINUTES: "15"
  
  # SQL Server Connection (Docker container on same host - PRIMARY)
  DB_USER: "sa"
  DB_PASSWORD: "CrmPass@Dev2024!"
  DB_CONNECTION_STRING: "Server=192.168.0.9,1433;Database=crm_db;User Id=sa;Password=CrmPass@Dev2024!;TrustServerCertificate=True"
  
  # Alternative Database Connections (for reference)
  MARIADB_CONNECTION_STRING: "Server=192.168.0.9;Port=3306;Database=crm_db;User=crm_user;Password=CrmPass@Dev2024!;"
  POSTGRES_CONNECTION_STRING: "Host=192.168.0.9;Port=5432;Database=crm_db;Username=crm_user;Password=CrmPass@Dev2024!"

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: crm-api
  namespace: crm-app

---
# Storage for API data (contracts, uploads, etc.)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crm-api-data
  namespace: crm-app
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
